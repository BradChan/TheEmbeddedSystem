===========================
1.3 嵌入式系统软件
===========================

硬件是计算机系统的基础设施，软件决定计算机系统具有什么样的功能。图书馆内供读者查询信息的设备就是一台标准的桌面计算机，
银行或政府办事大厅的排队取号、叫号设备也是一台标准的桌面计算机，这些设备的硬件区别几乎仅有可能是外设，决定这些设备功能
的因素只有软件，准确地说软件指的是应用程序，如图书馆信息查询系统软件、排队系统软件等。请注意，本书不刻意区分“程序和软件”。

事实上，所以计算机系统的硬件只能执行几十到几百种机器指令，无论是数百万行的应用程序或是几百行应用程序，他们都是为了实现
某种特定功能而有序地组合起来的机器指令。机器指令从诞生那一刻起就是二进制形式表示，人类很难读懂机器指令，所以现代的所有
计算机体系架构的每一种机器指令都有方便人类识别的指令助记符。指令助记符，也称汇编指令。

或许你从来没有见过汇编指令级别的程序，即使见到这样的程序，你或许也觉得可读性极差！你能想象计算机诞生的早期的那些程序员们
使用机器指令/二进制码编写程序的难度吗？从上世纪70年代开始，计算机科学的一个重要分支就是高级编程语言及其编译器的研究，
Python、C/C++、Java等高级编程语言大大地提高程序员们的工作效率，使用很少的语句就能实现很强大的功能。高级编程语言输出
的软件必须经过一系列的处理最终变成特定计算机系统硬件能够认识并执行的机器语言程序。我们通常把高级语言程序处理为机器语言程序
的软件统称为工具链，包括编译器(将高级语言程序编译成特定机器的汇编语言程序)和汇编器(将汇编语言程序、汇编库、二进制库、常量等
映射到特定硬件的程序存储器可用的机器码程序)。以ARMv8机器指令集为例，我们将一段C程序编译为汇编语言程序并通过汇编转换为
二进制机器码的过程 [1]_，如图1.10所示。


.. image:: ../_static/images/c1/c_asmble_machinecode.jpg
  :scale: 50%
  :align: center

图1.10  将高级语言程序转换为汇编语言程序再转换为机器语言程序的流程


高级编程语言不仅提高程序员的工作效率，还能让程序员使用接近自然语言的方式来思考问题和解决问题。二进制格式的机器语言程序是
为特定机器订制的，但高级编程语言的程序是可移植的，譬如我们使用不同的工具链可以将同一个C/C++程序转换不同机器的机器语言程序。
当然，任何高级语言程序的可移植性还受限于程序本身，或者说受限于程序员的工作。

----------------------------

使用过桌面计算机编写应用程序经历的绝大多数人都写过将字符串“hello world”显示在屏幕上的最简单应用程序，这个程序最关键的几行
代码就是告知编译器“加载标准输入/输出库”，并使用标准输入/输出库的字符流输出“hello world”字符串。即使需要编写、编译、执行如此
简单的程序之前必须安装文本编辑器软件、桌面计算机CPU和高级编程语言相关的工具链等软件，大多数情况你的确只安装了一个软件，
我们应该称之为“集成开发环境(IDE)”，譬如Visual Studio Code及C/C++工具链安装包。IDE本身是桌面计算机的一种应用程序，专门
用来编辑高级语言程序的文本，并将高级语言程序编译、汇编成为桌面计算机能够执行的机器指令程序。

在桌面计算机上编写高级语言程序、编译、汇编产生的本机可执行的机器语言程序，这个过程所用到的工具已有很多种选择，甚至高级语言
本身也有很多种选择。我们在桌面计算机上编写高级语言程序，能否在嵌入式计算机系统上执行呢？答案是肯定的。基于前一节的知识，
我们很容易想象嵌入式计算机系统的机器语言程序(二进制程序)必须装在到微控制器芯片内的程序存储器中执行，这与桌面计算机的应用程序
的执行完全不同。以C/C++语言为例，我们在桌面计算机上编写高级语言程序，并借助于目标嵌入式系统CPU的工具链将其转换为目标系统CPU
能够识别并执行的机器语言程序，这个过程称为交叉编译。

譬如我们的目标嵌入式系统CPU使用ARMv8指令集，我们需要一个IDE在桌面计算机上编写C/C++程序，并有IDE的工具链将C/C++程序转换成
ARMv8机器的二进制格式程序。高级语言程序和机器语言程序的片段如图1.10所示。另一个问题是，我们如何将嵌入式计算机系统的机器语言
程序从桌面计算机磁盘转移到微控制器的ROM内呢？我们把这个文件转移过程称作程序下载，也有人称之为烧录程序。这个过程必须借助于一些
专用的软硬件工具，譬如JTAG。

本书的第三章将会深入探讨嵌入式计算机系统的交叉编译、程序下载。使用桌面计算机的IDE应用程序和嵌入式计算机系统下载工具等实现
交叉编译和程序下载的流程如图1.11所示 [2]_。


.. image:: ../_static/images/c1/ec_dev_software_1.jpg
  :scale: 40%
  :align: center

图1.11  嵌入式计算机系统软件开发(以C/C++编程语言开发ARM Coretx-M系统为例)

----------------------------

当前，Python编程语言是全球最流行的高级编程语言之一，本书的很多示例都将使用Python语言。Python是一种可读性极高的脚本语言，
相较于C/C++、Fortran等高级语言更接近人类的自然语言，Python语言的程序员们考虑问题的方式更接近日常习惯。





----------------------------

参考文献：
::

.. [1] 计算机组成与设计：硬件/软件接口(第5版), David A. Petterson, John L. Hennessy著, 陈微 译, 机械工业出版社, 2018
.. [2] 
